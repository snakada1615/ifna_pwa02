{% extends 'myApp/_base.html' %}
{% load static %}
{% load humanize %}
{% block content %}

  <div class="container" style="max-width: 540px;">
    <div class="row">
      <div class="col-2 my-0 px-3">
        <img src="{% static 'img/no3.png' %}">
      </div>
      <div class="col-8 my-0 px-1">
        <h5>
          agree on nutrition target for
          {{ myLocation.name }}
        </h5>
      </div>
      <div class="col-2 my-0 px-3">
        <div class="col-3>">
          <a id="btn_save" class="btn btn-warning text-dark mt-2 my-0 py-0 btn-sm">save</a>
        </div>
      </div>
    </div>
  </div>

  <div class="container" style="max-width: 540px;">
    <div id="accordion">
      <div class="card border-dark bg-light col-12 mt-2 py-0" style="max-width: 540px;">
        <div class="row">
          <div class="col-12">
            <div class="card-body py-0 px-0">
              <p class="card-text my-0">
                {{ myLocation.myCountry.NAME_0 }}
              </p>
              <p class="card-text my-0">
                {{ myLocation.myCountry.NAME_1 }}
                <span class="fb fb-help" data-toggle="tooltip" title="Tooltip message"></span>
              </p>
              <p class="card-text my-0">
                {{ myLocation.myCountry.NAME_2 }}
              </p>
              <p class="card-text my-0">
                {{ myLocation.myCountry.NAME_3 }}
              </p>
              <p class="card-text text-success my-0">
                {{ myLocation.name }}
              </p>
              <button class="btn btn-link" data-toggle="collapse" data-target="#more_info" aria-expanded="true"
                      aria-controls="more_info">
                more info
              </button>

              <div id="more_info" class="collapse" aria-labelledby="more_info1" data-parent="#accordion">
                <p class="card-text my-0">
                  stunting rate:
                  {{ myLocation.stunting_rate }}
                </p>
                <p class="card-text my-0">
                  wasting rate:
                  {{ myLocation.wasting_rate }}
                </p>
                <p class="card-text my-0">
                  anemia rate:
                  {{ myLocation.anemia_rate }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <span></span>
      </div>
    </div>
  </div>

  <div class="container border-secondary py-1 my-1"
       style="max-width: 540px; background-color:#F3F3F3;border-width: 2px;">
    <!-- 4個分のタブ -->
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a href="#tab1_link" class="nav-link {% ifequal page 1 %}active{% endifequal %}" id="tab1"
           data-toggle="tab">individual</a>
      </li>
      <li class="nav-item">
        <a href="#tab2_link" class="nav-link {% ifequal page 2 %}active{% endifequal %}" id="tab2" data-toggle="tab">family</a>
      </li>
      <li class="nav-item">
        <a href="#tab3_link" class="nav-link {% ifequal page 3 %}active{% endifequal %}" id="tab3"
           data-toggle="tab">community</a>
      </li>
    </ul>

    <!-- 写真部分 -->
    <div class="tab-content">
      <div id="tab1_link" class="tab-pane {% ifequal page 1 %}active{% endifequal %}">
        {% include "./person_list_child1.html" %}
      </div>
      <div id="tab2_link" class="tab-pane {% ifequal page 2 %}active{% endifequal %}">
        {% include "./person_list_child2.html" %}
      </div>
      <div id="tab3_link" class="tab-pane {% ifequal page 3 %}active{% endifequal %}">
        {% include "./person_list_child3.html" %}
      </div>
    </div>
  </div>

  <style media="screen">
    /* nav-item activeの文字色 */
    .nav-tabs .nav-link.active, .nav-pills .show > .nav-link {
      color: red;
      background-color: #87BFCD;
    }

    /* number boxを読み取り専用に*/
    input[type="number"]:disabled {
      background: #dddddd;
    }
  </style>

  <script type="text/javascript">
    $('[data-toggle="tooltip"]').tooltip();

    let mytarget_scope_Sum ={{mytarget_scope_Sum}};
    if (mytarget_scope_Sum < 100) {
      $('#btn_add1').removeClass('disabled');
      $('#tab2').addClass('disabled');
      $('#tab2').removeAttr("data-toggle");
      $('#tab3').addClass('disabled');
      $('#tab3').removeAttr("data-toggle");
    } else {
      $('#btn_add1').addClass('disabled');
      $('#tab2').removeClass('disabled');
      $('#tab2').attr("data-toggle", "tab");
      $('#tab3').removeClass('disabled');
      $('#tab3').attr("data-toggle", "tab");
    }
    //    $('a[data-toggle="tab"]').on('show.bs. tab', function (e) {      let tmpTab = e.target.id      if (tmpTab == "tab1") {        $('#btn_add1').addClass('disabled');      } else {        $('#btn_add1').removeClass('disabled');      }    })


    //////////////////btn_save_person
    $('#btn_save').click(function () {
      let hostUrl = myRoot + 'registPerson/';
      let mydat = getTblData_all();

      console.log(mydat);
      Set_CRSF();
      sendJson(mydat, hostUrl);
    }); ////////btn_save_person///////////

    //////////////////getTblData
    function getTblData_all() { //
      let d = [];
      $('table.tbl_pop tr input ').each(function (i, myRow) {
        if ($(myRow).attr('nut_group_id') < 10) {
          let dd = {};
          dd['target_scope'] = $(myRow).attr('target_scope');
          dd["myLocation"] = {{myLocation.id}};
          dd['myuser'] = {{ myuser.id }};
          dd['nut_group_id'] = $(myRow).attr('nut_group_id');
          dd['target_pop'] = $(myRow).val();
          d.push(dd);
        }
      });

      let dd = {};
      dd['target_scope'] = "1";
      dd["myLocation"] = {{myLocation.id}};
      dd['myuser'] = {{ myuser.id }};
      dd['nut_group_id'] = $('#inpNum_ind7').text();
      dd['target_pop'] = "1";
      d.push(dd);

      return {"myJson": d};
    }

    //----------------------------------------------------------------------------


  </script>

{% endblock %}
