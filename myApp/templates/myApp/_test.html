{% extends 'myApp/_base.html' %}
{% load static %}
{% block content %}

  <script type="text/javascript" src="{% static 'DataTables/js/jquery.dataTables.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'DataTables/js/dataTables.select.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static 'DataTables/css/jquery.dataTables.min.css' %}"
        media="screen">
  <link rel="stylesheet" type="text/css" href="{% static 'DataTables/css/select.dataTables.min.css' %}"
        media="screen">
  <script type="text/javascript" src="{% static 'js/jquery.barrating.min.js' %}"></script>
  <link rel="stylesheet" href="{% static 'css/fontawesome-apple.css' %}">
  <link rel="stylesheet" href="{% static 'css/bars-1to10.css' %}">



  <!-------------title--------------------------->
  <div class="container" aria-live="polite" aria-atomic="true" style="max-width: 540px; position: relative;">

    <div class="container" style="max-width: 540px;">
      <div class="row">
        <div class="col-2 my-0 px-3">
          <img src="{% static 'img/no4.png' %}" alt="number 4">
        </div>
        <div class="col-8 my-0 px-1">
          <h5>
            Diet planning for
            {{ myLocation }}
          </h5>
        </div>
        <div class="col-2 my-0 px-3">
          <div class="row">
            <div class="col-12">
            <span>
              <a class="btn btn-warning mt-2 my-0 py-0 btn-sm" href="{% url 'index02' %}">back</a>
            </span>
              <span>
              <a mynum="100" id="btn_save_crop" class="btn btn-warning mt-2 my-0 py-0 btn-sm">save</a>
            </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-------------location information--------------------------->
    <div class="container" style="max-width: 540px;">
      <div id="accordion">
        <div class="card  border-dark bg-light col-12 mt-2 py-0" style="max-width: 540px;">
          <div class="row">
            <div class="col-12">
              <div class="card-body py-0 px-0">
                <p class="card-text text-success my-0">
                  myLocation:
                  {{ myLocation }}
                </p>
                <p class="card-text my-0">
                  country:
                  {{ myLocation.myCountry.NAME_0 }}
                </p>
                <p class="card-text my-0">
                  region:
                  {{ myLocation.myCountry.NAME_1 }}
                </p>
                <p class="card-text my-0">
                  province:
                  {{ myLocation.myCountry.NAME_2 }}
                </p>
                <p class="card-text my-0">
                  nutrition target:
                  {{ myLocation.nutrition_target }}
                </p>
                <button class="btn btn-link" data-toggle="collapse" data-target="#more_info" aria-expanded="true"
                        aria-controls="more_info">
                  more info
                </button>

                <div id="more_info" class="collapse" aria-labelledby="heading{{ crop.food_item_id }}"
                     data-parent="#accordion">
                  <p class="card-text my-0">
                    stunting rate:
                    {{ myLocation.stunting_rate }}
                  </p>
                  <p class="card-text my-0">
                    wasting rate:
                    {{ myLocation.wasting_rate }}
                  </p>
                  <p class="card-text my-0">
                    anemia rate:
                    {{ myLocation.anemia_rate }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- モーダルの設定 local crop ----------------------------->
    <div class="modal fade" id="Modal_localCrop1" mynum="0" tabindex="-1" role="dialog"
         aria-labelledby="Modal_localCropLabel">
      <div class="modal-dialog " role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add/remove food item</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="close">
              <span class="text-danger" aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body text-dark">
            <div class="my-2" id="myFilter1">Food group:
            </div>
            <table id="localCrop1" class="display compact" cellspacing="0" width="100%">
              <thead>
              <tr>
                <th>s</th>
                <th>Name</th>
                <th>En</th>
                <th>Pr</th>
                <th>VA</th>
                <th>Fe</th>
                <th>c</th>
              </tr>
              </thead>

              <tfoot>
              <tr>
                <th>s</th>
                <th>Name</th>
                <th>En</th>
                <th>Pr</th>
                <th>VA</th>
                <th>Fe</th>
                <th>c</th>
              </tr>
              </tfoot>
            </table>
            <a id="btn_exit01" class="btn btn-outline-secondary text-dark mt-2 my-0 py-0 btn-sm" data-dismiss="modal">close</a>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
    <!-------------------------------------->

    <!-- モーダルの設定 change diet volume----------------------------->
    <div class="container mx-0 my-0 px-0 py-0 ">
      <div class="modal fade" id="Modal_food_volume" tabindex="-1" role="dialog" aria-labelledby="Modal_foodVolLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title text-dark" id="Modal_foodVolLabel1">Determine the volume of food item</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body text-dark">
              <table border="1" class="table table-striped" id="tbl_food_SetWeight">
                <tr>
                  <th>name</th>
                  <th>En</th>
                  <th>Pr</th>
                  <th>Va</th>
                  <th>Fe</th>
                  <th>Wt</th>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
              </table>

              <span>*consumption target (1 portion=): <a href="#" id="btn_change_portion"></a>g</span>

              <div class="row pl-4">
                <div class="column-11">
                  <select id="BR_food_count">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                  </select>
                </div>
                <div class="column-1">
              <span class="fb fb-help d-inline" data-toggle="tooltip"
                    title="set volume of food by changing the number of apple icon below"></span>
                </div>
              </div>

              <div>*share (
                <span style="color: #5bc0de">production</span> /
                <span style="color: #cc1111">buy</span>):
                <img id="BR_buy_prod_pie_img" src="#" style="width: 30px" alt="">
                <span class="fb fb-help" data-toggle="tooltip" title="you can set buy or produce"></span>
              </div>

              <button type="button" class="btn btn-secondary mt-2" data-dismiss="modal">close</button>
              <button type="button" class="btn btn-primary mt-2" mynum="0" id="change_weight1">change value</button>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
      <!-- /.modal -->
    </div>
    <!-------------------------------------->

    <!-- モーダルの設定 change balance ----------------------------->
    <div class="modal fade" id="Modal_Prod_Buy" tabindex="-1" role="dialog" aria-labelledby="Modal_foodVolLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title text-dark" id="Modal_foodVolLabel1">Where do you get food (field or market)?</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <label class="modal-body text-dark">
            <label for="my_Prod_Buy" id="my_Prod_Buy-label1">*share (
              <span style="color: #cc1111">buy</span> /
              <span style="color: #5bc0de">production</span>):
            </label>
            <span class="fb fb-help" data-toggle="tooltip" title="Tooltip message"></span>

            <select id="my_Prod_Buy">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>

            <button type="button" class="btn btn-secondary mt-2" data-dismiss="modal">close</button>
            <button type="button" class="btn btn-primary mt-2" mynum="0" id="change_share1">change share</button>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
    <!-------------------------------------->

    <!-- モーダルの設定 change portion ----------------------------->
    <div class="modal fade" id="Modal_Portion" tabindex="-1" role="dialog" aria-labelledby="Modal_PortionLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title text-dark" id="Modal_PortionLabel1">Please set minimum portion size</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body text-dark">

            <form>
              <div class="form-group row">
                <label for="old_portion" class="col-sm-4 col-form-label">current value (g)</label>
                <div class="col-sm-8">
                  <input type="number" readonly class="form-control-plaintext" class="form-control" id="old_portion"
                         placeholder="portion size" value="30">
                </div>
                <label for="new_portion" class="col-sm-4 col-form-label">new value (g)</label>
                <div class="col-sm-8">
                  <input type="number" class="form-control" id="new_portion" placeholder="50">
                </div>
              </div>
            </form>

            <button type="button" class="btn btn-secondary mt-2" data-dismiss="modal">cancel</button>
            <button type="button" class="btn btn-primary mt-2" mynum="0" id="btn_set_portion">change portion</button>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
    <!-------------------------------------->


    <div id="container_tab_all" class="container border-secondary py-1 my-1 px-0"
         style="max-width: 540px; background-color:#F3F3F3;border-width: 2px;">
      <!-- 4個分のタブ -->
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a href="#tab1_link" class="nav-link active" id="tab1" data-toggle="tab">individual</a>
        </li>
        <li class="nav-item">
          <a href="#tab2_link" class="nav-link" id="tab2" data-toggle="tab">family</a>
        </li>
        <li class="nav-item">
          <a href="#tab3_link" class="nav-link" id="tab3" data-toggle="tab">community</a>
        </li>
      </ul>

      <!-- タブの移動先指定 -->
      <div class="tab-content">
        <div id="tab1_link" class="tab-pane active">
          {% include "./Diet_Sub1.html" %}
        </div>
        <div id="tab2_link" class="tab-pane">
          {% include "./Diet_Sub2.html" %}
        </div>
        <div id="tab3_link" class="tab-pane">
          {% include "./Diet_Sub3.html" %}
        </div>
      </div>
    </div>

    <!-------------toastの表示--------------------------->
    <button type="button" class="btn btn-primary" onclick="$('#toast1').toast('show')">Show</button>

    <!-- 次の行はtoast配置のための設定 -->
    <div style="position: absolute; top: 0; right: 0;">
      <div class="toast" id="toast1" role="alert">
        <div class="toast-header">
          <strong class="mr-auto">Bootstrap</strong>
          <small>11分前</small>
          <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="閉じる">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body">
          こんにちは！ これはトーストのメッセージです。
        </div>
      </div>
    </div>
    <!------------------------------------------------------------->

  </div>


  <style media="screen">
    /* set common variable */
    :root {
      --td_wid_normal: 30;
    }

    /* force rotate when screen width less than 450 */
    @media screen and (min-width: 320px) and (max-width: 450px) and (orientation: portrait) {
      html {
        transform: rotate(-90deg);
        transform-origin: left top;
        width: 100vh;
        overflow-x: hidden;
        position: absolute;
        top: 100%;
        left: 0;
      }
    }

    .mod-tbl {
      max-width: 650px;
    }

    .mytable {
      table-layout: fixed;
      border: 2px grey solid;
      border-collapse: collapse;
      width: 100%;
    }

    .mytable tbody th {
      width: var(--td_wid_normal) px;
      min-width: var(--td_wid_normal) px;
      border-collapse: collapse;
      border: 2px grey solid;
    }

    .mytable td {
      width: var(--td_wid_normal) px;
      min-width: var(--td_wid_normal) px;
      border: 2px grey solid;
      border-collapse: collapse;
      text-align: center;
      vertical-align: middle;
    }

    .mytable th {
      color: whitesmoke;
      background-color: #49A0B5;
      border: 2px grey solid;
      border-collapse: collapse;
      text-align: center;
      vertical-align: middle;
    }

    .mytable tr:nth-child(odd) td {
      color: darkblue;
      text-align: left;
      background-color: #49A0B5;
    }

    .mytable tr:nth-child(even) td {
      color: white;
      background-color: #F9F9F9;
    }

    /* 行または列の非表示*/
    .tableItem_hide {
      display: none;
    }


  </style>



  <script type="text/javascript">


    $('[data-toggle="tooltip"]').tooltip();

    // グローバル変数の作成
    var selected_rows_id = [];
    var myLocation = '';
    var myRoot = '';
    var json_crop_local_org = {{mylist_available|safe}};
    var json_crop_selected_org = {{mylist_selected|safe}};
    var json_crop_name = {{mylist_local_name|safe}};

    var target_en = [];
    var target_pr = [];
    var target_va = [];
    var target_fe = [];

    target_en[1] = {{dri_e1}};
    target_pr[1] = {{dri_p1}};
    target_va[1] = {{dri_v1}};
    target_fe[1] = {{dri_f1}};
    target_en[2] = {{dri_e2}};
    target_pr[2] = {{dri_p2}};
    target_va[2] = {{dri_v2}};
    target_fe[2] = {{dri_f2}};
    target_en[3] = {{dri_e3}};
    target_pr[3] = {{dri_p3}};
    target_va[3] = {{dri_v3}};
    target_fe[3] = {{dri_f3}};


    let url_tmp = window.location.href.split('/');
    let tmp1 = url_tmp[url_tmp.length - 2];
    url_tmp.pop();
    url_tmp.pop();
    url_tmp.pop();
    myRoot = url_tmp.join("/") + '/';
    var myLocation_id = tmp1;

    //  myRating_**を配列に組み込む -----------
    let myRating_en = {};
    let myRating_pr = {};
    let myRating_va = {};
    let myRating_fe = {};
    $('.rating_DRI').each(function (i) {
      let tmp_myNum = $(this).attr('myNum');
      i = (i) % 4;
      switch (i) {
        case 0:
          myRating_en[tmp_myNum] = $(this);
          break;
        case 1:
          myRating_pr[tmp_myNum] = $(this);
          break;
        case 2:
          myRating_va[tmp_myNum] = $(this);
          break;
        case 3:
          myRating_fe[tmp_myNum] = $(this);
          break;
      }
    });

    //  selected_crops_tbl_**を配列に組み込む -----------
    let $tbl_Crop_Selected = {};
    $('.selected_crops_tbl').each(function () {
      let num_tbl = $(this).attr('myNum');
      $tbl_Crop_Selected[num_tbl] = $(this);
    });


    //////////////// set local name/////
    let index = {};
    let json_crop_local = [];
    let json_crop_selected = [];
    json_crop_name.forEach(token => index[token.food_item_id] = token);
    json_crop_local_org.forEach(token => {
      if (index[token.food_item_id]) {
        token.Food_grp = index[token.food_item_id].Food_grp;
        token.Food_name = index[token.food_item_id].Food_name;
      }
      json_crop_local.push(token);
    });
    json_crop_selected_org.forEach(token => {
      if (index[token.food_item_id]) {
        token.Food_grp = index[token.food_item_id].Food_grp;
        token.Food_name = index[token.food_item_id].Food_name;
      }
      json_crop_selected.push(token);
    });
    console.log('初期選択品目の一覧：');
    console.log(json_crop_selected);
    //---------------------------------------------

    //////////////// star rating/////
    $(function () {
      $('.rating_DRI').barrating({theme: 'bars-1to10', showSelectedRating: false, readonly: true}); // set barrating
      $('#my_Prod_Buy').barrating({theme: 'bars-1to10', showSelectedRating: true, readonly: false}); // set barrating)
      $('#BR_food_count').barrating({theme: 'fontawesome-apple'});
    });

    ///////////set nutrition target for each table  /////////////////////
    $('.lbl_target_en[myNum^=1]').text(target_en[1].toFixed(0));
    $('.lbl_target_pr[myNum^=1]').text(target_pr[1].toFixed(0));
    $('.lbl_target_va[myNum^=1]').text(target_va[1].toFixed(0));
    $('.lbl_target_fe[myNum^=1]').text(target_fe[1].toFixed(0));
    $('.lbl_target_en[myNum^=2]').text(target_en[2].toFixed(0));
    $('.lbl_target_pr[myNum^=2]').text(target_pr[2].toFixed(0));
    $('.lbl_target_va[myNum^=2]').text(target_va[2].toFixed(0));
    $('.lbl_target_fe[myNum^=2]').text(target_fe[2].toFixed(0));
    $('.lbl_target_en[myNum^=3]').text(target_en[3].toFixed(0));
    $('.lbl_target_pr[myNum^=3]').text(target_pr[3].toFixed(0));
    $('.lbl_target_va[myNum^=3]').text(target_va[3].toFixed(0));
    $('.lbl_target_fe[myNum^=3]').text(target_fe[3].toFixed(0));


    //    create object setup "Crop_Selected"   -------------------------------
    function Crop_Selected(num_Tbl) {
      const myRange = [101, 102, 103, 104, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212];
      const found = myRange.find(element => element === num_Tbl);
      if (found) {
        this.crops = [];
        this.num_Tbl = num_Tbl;
        this.sum_en = 0;
        this.sum_pr = 0;
        this.sum_va = 0;
        this.sum_fe = 0;

        let target_scope = Math.trunc(num_Tbl / 100);
        this.target_en = target_en[target_scope];
        this.target_pr = target_pr[target_scope];
        this.target_va = target_va[target_scope];
        this.target_fe = target_fe[target_scope];
        console.log('オブジェクトCrop_Selected' + num_Tbl + 'を作成しました');
        console.log(this.getAllCrop());
      } else {
        console.error('オブジェクトCrop_Selected' + num_Tbl + 'を作成できません。テーブル番号が不正です');
      }
    }

    Crop_Selected.prototype.getAllCrop = function () {
    };
    Crop_Selected.prototype.setAllCrop = function () {
    };
    Crop_Selected.prototype.getCrop = function (food_item_id) {
      const found = this.crops.find(element => element.food_item_id === food_item_id);
      return found || 'none';
    };
    Crop_Selected.prototype.delCrop = function (food_item_id) {
      const found = this.crops.indexOf(food_item_id);
      if (found > -1) {
        this.crops[found].delete();
      }
    };
    Crop_Selected.prototype.setCrop = function (crop_data) {
      this.delCrop(crop_data.food_item_id);
      this.crops.push(crop_data);
    };
    Crop_Selected.prototype.drawAllTable = function () {
      // まず合計行を削除
      $tbl_Crop_Selected[this.num_Tbl].children('tbody').children('tr').last().remove();
      // 追加行の挿入
      for (let mycrop in this.crops) {
        let mycrop_html = this._drawRaw_setHtml(this.crops[mycrop]);
        $tbl_Crop_Selected[this.num_Tbl].append(mycrop_html);
      }
      // 合計行の再計算の挿入
      this._drawRaw_total();
    };
    Crop_Selected.prototype.drawRaw = function (food_item_id) {
      let total = '';
      let add_data = this.getCrop(food_item_id);
      if (add_data !== 'none') {
        // まず合計行を削除
        $tbl_Crop_Selected[this.num_Tbl].children('tbody').children('tr').last().remove();
        // 追加行の作成
        const add_data_html = this._drawRaw_setHtml(add_data);
        // 追加行の挿入
        $tbl_Crop_Selected[this.num_Tbl].append(add_data_html);
        // 合計行の作成と挿入
        this._drawRaw_total()

      } else {
        console.error('指定されたfood_item_id(' + food_item_id + ')は存在しません');
      }
    };
    Crop_Selected.prototype._drawRaw_setHtml = function (add_data) {
      // 追加行の作成
      let cr = '';
      cr += '<tr>';
      cr += '<td>' + add_data.name + '</td>';
      cr += '<td>' + Math.round(add_data.Energy * add_data.total_weight / 100, 1) + '</td>';
      cr += '<td>' + Math.round(add_data.Protein * add_data.total_weight / 100, 1) + '</td>';
      cr += '<td>' + Math.round(add_data.VITA_RAE * add_data.total_weight / 100, 1) + '</td>';
      cr += '<td>' + Math.round(add_data.FE * add_data.total_weight / 100, 1) + '</td>';
      cr += '<td>' + add_data.total_weight + '</td>';
      cr += '<td class="tableItem_hide"></td>';
      cr += '<td class="tableItem_hide">' + add_data.food_item_id + '</td>';
      cr += '<td class="tableItem_hide">' + add_data.portion_size + '</td>';
      cr += '<td class="tableItem_hide">' + add_data.count_prod + '</td>';
      cr += '<td class="tableItem_hide">' + add_data.count_buy + '</td>';
      cr += '<td class="tableItem_hide">' + add_data.Energy + '</td>';
      cr += '<td class="tableItem_hide">' + add_data.Protein + '</td>';
      cr += '<td class="tableItem_hide">' + add_data.VITA_RAE + '</td>';
      cr += '<td class="tableItem_hide">' + add_data.FE + '</td>';
      cr += '<td class="tableItem_hide">' + add_data.share_prod_buy + '</td>';
      cr += '</tr>';
      return cr;
    };
    Crop_Selected.prototype._drawRaw_total = function () {
      // 合計行の再計算
      this.Sum_Nutrition();
      // 合計行の挿入
      target_scope = Math.trunc(this.num_Tbl / 100);
      total = '<tr><td>total</td>' +
              this._setCellColor(Math.round(this.sum_en), target_en[target_scope]) +
              this._setCellColor(Math.round(this.sum_pr), target_pr[target_scope]) +
              this._setCellColor(Math.round(this.sum_va), target_va[target_scope]) +
              this._setCellColor(Math.round(this.sum_fe), target_fe[target_scope]) +
              '<td></td><td class="tableItem_hide"><' + '/td><td class="tableItem_hide">' +
              '</td><td class="tableItem_hide"></td><td class="tableItem_hide">' +
              '</td><td class="tableItem_hide"></td></tr>';
      $tbl_Crop_Selected[this.num_Tbl].append(total);
      // Barratingセット
      this.SetBarrating(this.num_Tbl);
    };
    Crop_Selected.prototype.SetBarrating = function () {
      let rate_en = Math.round(this.sum_en * 10 / this.target_en);
      if (rate_en > 10) {
        rate_en = 10
      } else if (rate_en < 1) {
        rate_en = 1
      }
      let rate_pr = Math.round(this.sum_pr * 10 / this.target_pr);
      if (rate_pr > 10) {
        rate_pr = 10
      } else if (rate_pr < 1) {
        rate_pr = 1
      }
      let rate_va = Math.round(this.sum_va * 10 / this.target_va);
      if (rate_va > 10) {
        rate_va = 10
      } else if (rate_va < 1) {
        rate_va = 1
      }
      let rate_fe = Math.round(this.sum_fe * 10 / this.target_fe);
      if (rate_fe > 10) {
        rate_fe = 10
      } else if (rate_fe < 1) {
        rate_fe = 1
      }

      myRating_en[this.num_Tbl].barrating('set', rate_en); // set barrating
      myRating_pr[this.num_Tbl].barrating('set', rate_en); // set barrating
      myRating_va[this.num_Tbl].barrating('set', rate_en); // set barrating
      myRating_fe[this.num_Tbl].barrating('set', rate_en); // set barrating

    };
    Crop_Selected.prototype._setCellColor = function (i_cell, i_target) {
      let res = '';
      cNum = parseInt(i_cell * 100 / i_target, 10);
      switch (true) {
        case 0 <= cNum && cNum < 50:
          res = '<td style="color:red;">' + i_cell + '</td>';
          break;

        case 50 <= cNum && cNum < 100:
          res = '<td style="color:orange;">' + i_cell + '</td>';
          break;

        case 100 <= cNum:
          res = '<td style="color:green;">' + i_cell + '</td>';
          break;

        default:
          res = '<td>' + i_cell + '</td>';
          break;
      }
      return res;
    };
    Crop_Selected.prototype.Sum_Nutrition = function () {
      $tbl_Crop_Selected[this.num_Tbl].children('tbody').children('tr').each(function (j, myRow) {
        if ($(myRow).children('td').eq(0).text() !== 'total') {
          this.sum_en += Number($(myRow).children('td').eq(1).text());
          this.sum_pr += Number($(myRow).children('td').eq(2).text());
          this.sum_va += Number($(myRow).children('td').eq(3).text());
          this.sum_fe += Number($(myRow).children('td').eq(4).text());
        }
      });
    };
    Crop_Selected.prototype.drawCell = function () {
    };
    Crop_Selected.prototype.eraseRaw = function () {

    };
    Crop_Selected.prototype.eraseTable = function () {
    };

    //---------------------------------------------

    const myRange = [101, 102, 103, 104, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212];
    let myCrop = {};
    for (let i in myRange) {
      myCrop[myRange[i]] = new Crop_Selected(myRange[i]);
    }

    for (var i = 0; i < json_crop_selected.length; i++) {
      data = json_crop_selected[i];
      if (data.myLocation === Number(myLocation_id)) {
        let num_tbl = data.myid_tbl;
        myCrop[data.myid_tbl].setCrop(data);
      }
    }

    for (let i in myRange) {
      myCrop[myRange[i]].drawAllTable();
    }



  </script>


{% endblock %}
