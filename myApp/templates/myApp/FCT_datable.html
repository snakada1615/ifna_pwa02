{% extends 'myApp/base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<script type="text/javascript" src="{% static 'DataTables/js/jquery.dataTables.min.js' %}"></script>
<script type="text/javascript" src="{% static 'DataTables/js/dataTables.select.min.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'DataTables/css/jquery.dataTables.min.css' %}" media="screen">
<link rel="stylesheet" type="text/css" href="{% static 'DataTables/css/select.dataTables.min.css' %}" media="screen">


<script>
// URLパラメータの取得
var myFamily = '';
var items = [];

getHTML_param = function() {
  var url_tmp = window.location.href.split('/');
  var tmp1 = url_tmp[url_tmp.length-3];
  var tmp2 = url_tmp[url_tmp.length-2];
  items.length = 0;
  if (tmp2 == '0') {
    items.push('0');
  } else if (tmp2.indexOf('-') < 0) {
    items.push(tmp2);
  } else {
    items = tmp2.split('-');
  }
  return tmp1;
}

$(document).ready(function() {
  var table = $('#example').DataTable( {
    "ajax": "{% static 'DataTables/data/FCT.txt' %}",
    "columns": [
        { "data": "Food_name" },
        { "data": "Protein" },
        { "data": "VITA_RAE" },
        { "data": "FE" },
    ],

    "initComplete": function(settings, json) {
      getHTML_param();
      table.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
        var data = this.data();
        if (items.indexOf(data.food_item_id) >= 0) {
          this.select();
        }
      } );
    }

  } );

    $('#example tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );


    $('#button').click( function () {
        var s = "";
        var n = "";
        table.rows('.selected').every( function ( rowIdx, tableLoop, rowLoop ) {
            var data = this.data();
            s += data.Food_name + "\n";
            n += "-" + data.FCT_id;

            // ... do something with data(), or this.node(), etc
        } );
        n = n.substring(1);
        window.confirm(s);
        window.confirm(n);

    } );

} );
</script>

<div class="container" style="max-width: 540px;">
  <div class="row">
    <div class="col text-danger">
      <h5>nutrition target for {{name}}</h5>
    </div>
  </div>
</div>

<div class="container text-white" style="max-width: 540px;">
    <div class="card border-primary bg-info col-12 mt-2 py-0" style="max-width: 540px;">
      <div class="row">
        <div class="col-12">
          <div class="card-body py-0 px-0">
            <h5 class="card-title my-0">
              {{ name }}
            </h5>
            <p class="card-text my-0">
              {{ country }}
            </p>
            <p class="card-text my-0">
              {{ region }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

<div class="container text-white" style="max-width: 540px;">
    <div class="card border-primary bg-info col-12 mt-2" style="max-width: 540px;">
      <div class="row">
        <div class="col-12">
          <div class="card-body py-0 px-0">
            <div class="row">
              <div class="col-7 ">
                Nutrients
              </div>
              <div class="col-5 ">
                Target
              </div>
            </div>
            <div class="row">
              <div class="col-7 ">
                protein(g/day)
              </div>
              <div class="col-5 ">
                {{dri_p|floatformat:2}}
              </div>
            </div>
            <div class="row">
              <div class="col-7 ">
                vit-A(μg/day)
              </div>
              <div class="col-5 ">
                {{dri_v|intcomma}}
              </div>
            </div>
            <div class="row">
              <div class="col-7 ">
                Fe(mg/day)
              </div>
              <div class="col-5 ">
                {{dri_f|floatformat:2}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container text-white" style="max-width: 540px;">
      <div class="card border-primary bg-info col-12 mt-2 py-0" style="max-width: 540px;">
        <div class="row">
          <div class="col-12">
            <div class="card-body py-0 px-0">
              <h5 class="card-title my-0">
                selected commodities
              </h5>
              <p class="card-text my-0">
                {{ country }}
              </p>
              <p class="card-text my-0">
                {{ region }}
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
            <span><a class="btn btn-outline-secondary mt-2 my-0 py-0 btn-sm" href="{% url 'Family_index' %}">back</a></span>
            <span><a class="btn btn-outline-secondary mt-2 my-0 py-0 btn-sm" href="{% url 'person_create' familyid=familyid %}">+</a></span>
            <span><a class="btn btn-outline-secondary mt-2 my-0 py-0 btn-sm align-middle" href="{% url 'fctdata' familyid=familyid items=items %}">move next</a></span>
        </div>
      </div>
    </div>


  <hr>

<button type="button" id="button" >select count</button>
<table id="example" class="display compact" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>Name</th>
            <th>Pr</th>
            <th>VA</th>
            <th>Fe</th>
        </tr>
    </thead>

    <tfoot>
        <tr>
          <th>Name</th>
          <th>Pr</th>
          <th>VA</th>
          <th>Fe</th>
        </tr>
    </tfoot>
</table>
{% endblock %}
