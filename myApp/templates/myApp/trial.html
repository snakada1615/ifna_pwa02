{% extends 'myApp/base.html' %}
{% load static %}
{% block content %}


<div id="greet">select target area</div>

<p><select id="counry_dl" onclick="selCnt(this)"></select></p>
<p><select id="subdiv1_dl" onclick="selSub1(this)"></select></p>
<p><select id="subdiv2_dl"></select></p>

<script type="text/javascript">
  var cnt_arr = {{countries | safe}};
  var cnt_list = [];
  var cnt_key = [];
  var subDiv_list1 = [];
  var subDiv_list2 = [];
  var subDiv_key1 = [];
  var subDiv_key2 = [];

  function getCountry() {
    cnt_list =[];
    cnt_list.push("--select country--")
    cnt_key.push("")
    cnt_arr.forEach(function(val) {
      if (cnt_list.indexOf(val.fields["NAME_0"]) == -1) {
        cnt_list.push(val.fields["NAME_0"]);
        cnt_key.push(val.fields["GID_0"]);
      }
    });
  }

  function getSubDiv1(parentAdm) {
    subDiv_list1 = [];
    subDiv_key1 = [];
    subDiv_list1.push("--select subdivision1--");
    subDiv_key1.push("");
    cnt_arr.forEach(function(val) {
      if (val.fields["GID_0"] == parentAdm) {
        if (subDiv_list1.indexOf(val.fields["NAME_1"]) == -1) {
          subDiv_list1.push(val.fields["NAME_1"]);
          subDiv_key1.push(val.fields["GID_1"]);
        }
      }
    });
  }

  function getSubDiv2(parentAdm) {
    subDiv_list2 = [];
    subDiv_key2 = [];
    subDiv_list2.push("--select subdivision2--");
    subDiv_key2.push("");
    cnt_arr.forEach(function(val) {
      if (val.fields["GID_1"] == parentAdm) {
        if (subDiv_list2.indexOf(val.fields["NAME_2"]) == -1) {
          subDiv_list2.push(val.fields["NAME_2"]);
          subDiv_key2.push(val.fields["GID_2"]);
        }
      }
    });
  }

  function selCnt(obj) {
    getSubDiv1(obj.value);
    var selObj = document.getElementById('subdiv1_dl');
    while (selObj.lastChild) {
      selObj.removeChild(selObj.lastChild);
    }
    for (var i = 0; i < subDiv_list1.length; i++) {
      let op = document.createElement("option");
      op.value = subDiv_key1[i];
      op.text = subDiv_list1[i];
      selObj.appendChild(op);
    }

    // delete subdiv2 list also
    var selObj = document.getElementById('subdiv2_dl');
    while (selObj.lastChild) {
      selObj.removeChild(selObj.lastChild);
    }
  }

  function selSub1(obj) {
    getSubDiv2(obj.value);
    var selObj = document.getElementById('subdiv2_dl');
    while (selObj.lastChild) {
      selObj.removeChild(selObj.lastChild);
    }
    for (var i = 0; i < subDiv_list2.length; i++) {
      let op = document.createElement("option");
      op.value = subDiv_key2[i];
      op.text = subDiv_list2[i];
      selObj.appendChild(op);
    }
  }

  // initislize country list -------------------

  getCountry();
  for (var i = 0; i < cnt_list.length; i++) {
    let op = document.createElement("option");
    op.value = cnt_key[i];
    op.text = cnt_list[i];
    document.getElementById("counry_dl").appendChild(op);
  }
</script>


{% endblock %}
